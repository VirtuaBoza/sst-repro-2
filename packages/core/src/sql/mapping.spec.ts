import { describe, expect, it } from "vitest";
import { mapToNested } from "./mapping";

describe("mapToNested", () => {
  it("should map correctly", () => {
    const records = [
      {
        foo: {
          bar: "baz",
          buzz: "fizz",
        },
        library: {
          lib_id: 1,
          nameOfLibrary: "Org 1 Lib 1",
        },
        organization: {
          id: 1,
          name: "Org 1",
        },
      },
      {
        foo: {
          bar: "baz",
          buzz: "fizz",
        },
        library: {
          lib_id: 2,
          nameOfLibrary: "Org 1 Lib 2",
        },
        organization: {
          id: 1,
          name: "Org 1",
        },
      },
      {
        foo: {
          bar: "buzz",
          buzz: "?",
        },
        library: {
          lib_id: 3,
          nameOfLibrary: "Org 2 Lib 1",
        },
        organization: {
          id: 2,
          name: "Org 2",
        },
      },
    ];

    const res1 = mapToNested(records, [
      "organization",
      "id",
      {
        foo: "foo",
        libraries: ["library", "lib_id"],
      },
    ]);

    expect(res1).toEqual([
      {
        foo: {
          bar: "baz",
          buzz: "fizz",
        },
        id: 1,
        libraries: [
          {
            lib_id: 1,
            nameOfLibrary: "Org 1 Lib 1",
          },
          {
            lib_id: 2,
            nameOfLibrary: "Org 1 Lib 2",
          },
        ],
        name: "Org 1",
      },
      {
        foo: {
          bar: "buzz",
          buzz: "?",
        },
        id: 2,
        libraries: [
          {
            lib_id: 3,
            nameOfLibrary: "Org 2 Lib 1",
          },
        ],
        name: "Org 2",
      },
    ]);
  });

  it("works with real data", () => {
    const TEST_DATA = [
      {
        book: {
          createdAt: "2024-03-11T01:21:06.555Z",
          id: "73fd268e-8ed8-44fb-93fb-9d760198293e",
          libraryId: "f368ad5d-495f-41ba-9c7d-9c48ff1007c2",
          readingGrade: null,
          seriesEntry: null,
          seriesName: "I Like to Read Comics",
          summary:
            "The Super Duper Seven are holding auditions for their crime-fighting superhero club but Hungry Kitty keeps eating members of the team.",
          targetAgeMax: 11,
          targetAgeMin: 7,
          title: "Meet the Super Duper Seven",
        },
        book_author: {
          bookId: "73fd268e-8ed8-44fb-93fb-9d760198293e",
          createdAt: "2024-03-11T01:21:06.555Z",
          id: "dbd42573-24e6-4571-8709-3dd4e48986e4",
          index: 0,
          libraryId: "f368ad5d-495f-41ba-9c7d-9c48ff1007c2",
          name: "Hamilton, Tim",
          relation: "author, illustrator",
        },
        book_edition: {
          bookId: "73fd268e-8ed8-44fb-93fb-9d760198293e",
          createdAt: "2024-03-11T01:21:06.555Z",
          id: "bb37415c-b564-4d9e-bf43-1e278fcd65d7",
          isbn10: null,
          isbn13: "9780823449101",
          libraryId: "f368ad5d-495f-41ba-9c7d-9c48ff1007c2",
          pageCount: 36,
          publishedYear: null,
          publisherName: null,
        },
        book_edition_copy: {
          bookId: "73fd268e-8ed8-44fb-93fb-9d760198293e",
          callNumber: "FIC HAM",
          createdAt: "2024-03-11T01:21:06.555Z",
          editionId: "bb37415c-b564-4d9e-bf43-1e278fcd65d7",
          id: "aea2266e-8336-4281-8a9a-8f66aaef7c81",
          importRecordId: "7b038016-3ee8-4530-a213-22baf4b7f9f7",
          libraryId: "f368ad5d-495f-41ba-9c7d-9c48ff1007c2",
        },
        catalog_item: {
          createdAt: "2024-03-11T01:21:06.555Z",
          id: "73fd268e-8ed8-44fb-93fb-9d760198293e",
          libraryId: "f368ad5d-495f-41ba-9c7d-9c48ff1007c2",
        },
        catalog_item_collection_assignment: null,
        catalog_item_copy: {
          acquisitionDate: null,
          availability: "AVAILABLE",
          barcode: "00000000000001",
          createdAt: "2024-03-11T01:21:06.555Z",
          id: "aea2266e-8336-4281-8a9a-8f66aaef7c81",
          itemId: "73fd268e-8ed8-44fb-93fb-9d760198293e",
          libraryId: "f368ad5d-495f-41ba-9c7d-9c48ff1007c2",
          location: null,
          purchasePriceAmount: null,
          purchasePriceCurrency: "USD",
        },
        checkout: null,
        hold: null,
      },
      {
        book: {
          createdAt: "2024-03-11T01:21:06.555Z",
          id: "203c3fb7-094e-4431-b5e4-c7957165fde8",
          libraryId: "f368ad5d-495f-41ba-9c7d-9c48ff1007c2",
          readingGrade: null,
          seriesEntry: null,
          seriesName: null,
          summary:
            "When Jasper Rabbit finds a purple crayon willing to do his schoolwork for him, he is elated--at first.",
          targetAgeMax: 11,
          targetAgeMin: 7,
          title: "Creepy Crayon!",
        },
        book_author: {
          bookId: "203c3fb7-094e-4431-b5e4-c7957165fde8",
          createdAt: "2024-03-11T01:21:06.555Z",
          id: "6bae7b2d-f7fc-4e48-982d-8fd900b75963",
          index: 0,
          libraryId: "f368ad5d-495f-41ba-9c7d-9c48ff1007c2",
          name: "Reynolds, Aaron",
          relation: "author",
        },
        book_edition: {
          bookId: "203c3fb7-094e-4431-b5e4-c7957165fde8",
          createdAt: "2024-03-11T01:21:06.555Z",
          id: "1ffdd362-d139-47e9-a839-c1884afb9339",
          isbn10: null,
          isbn13: "9781534465886",
          libraryId: "f368ad5d-495f-41ba-9c7d-9c48ff1007c2",
          pageCount: 43,
          publishedYear: null,
          publisherName: null,
        },
        book_edition_copy: {
          bookId: "203c3fb7-094e-4431-b5e4-c7957165fde8",
          callNumber: "FIC REY",
          createdAt: "2024-03-11T01:21:06.555Z",
          editionId: "1ffdd362-d139-47e9-a839-c1884afb9339",
          id: "1aed8fbd-4fd5-4ca7-a05a-c553584b3325",
          importRecordId: "a08ccbec-9fb5-4ccc-a6fd-d2207845b33d",
          libraryId: "f368ad5d-495f-41ba-9c7d-9c48ff1007c2",
        },
        catalog_item: {
          createdAt: "2024-03-11T01:21:06.555Z",
          id: "203c3fb7-094e-4431-b5e4-c7957165fde8",
          libraryId: "f368ad5d-495f-41ba-9c7d-9c48ff1007c2",
        },
        catalog_item_collection_assignment: null,
        catalog_item_copy: {
          acquisitionDate: null,
          availability: "AVAILABLE",
          barcode: "00000000000004",
          createdAt: "2024-03-11T01:21:06.555Z",
          id: "1aed8fbd-4fd5-4ca7-a05a-c553584b3325",
          itemId: "203c3fb7-094e-4431-b5e4-c7957165fde8",
          libraryId: "f368ad5d-495f-41ba-9c7d-9c48ff1007c2",
          location: null,
          purchasePriceAmount: null,
          purchasePriceCurrency: "USD",
        },
        checkout: null,
        hold: null,
      },
      {
        book: {
          createdAt: "2024-03-11T01:21:06.555Z",
          id: "b725fc40-0852-4fc7-bd0e-ab68df0fd2e9",
          libraryId: "f368ad5d-495f-41ba-9c7d-9c48ff1007c2",
          readingGrade: null,
          seriesEntry: null,
          seriesName: null,
          summary:
            "The creators of the acclaimed Over the Shop evoke a perfect summer beach day--and themes of creativity, cooperation, flexibility, and persistence--all without a word in this sun-warmed, salt-stained delight of a story. A busload of beachgoers spills out onto the sand for a day of fun and frolic. Three siblings begin work on a castle, patting and shaping the sand as the sun arcs over the sky. Time and again, their progress is halted: a windswept hat topples their creation; a toddler ambles through it; the tide creeps close, and then too close. Meeting each demolition with fresh determination, the builders outdo themselves time and again, until the moment arrives to pile back into the bus for home. An authentic portrait of sibling cooperation--and glorious inspiration for creative people of all ages--A Day for Sandcastles channels the thrill of surrendering expectations on the path to infinite possibility.",
          targetAgeMax: 6,
          targetAgeMin: 5,
          title: "A Day for Sandcastles",
        },
        book_author: {
          bookId: "b725fc40-0852-4fc7-bd0e-ab68df0fd2e9",
          createdAt: "2024-03-11T01:21:06.555Z",
          id: "9e0aa135-8309-4dda-b63a-6d718363977a",
          index: 0,
          libraryId: "f368ad5d-495f-41ba-9c7d-9c48ff1007c2",
          name: "Lawson, JonArno",
          relation: "author",
        },
        book_edition: {
          bookId: "b725fc40-0852-4fc7-bd0e-ab68df0fd2e9",
          createdAt: "2024-03-11T01:21:06.555Z",
          id: "88d88eaf-47ae-40ca-87e6-0d3174054997",
          isbn10: null,
          isbn13: "9781536208429",
          libraryId: "f368ad5d-495f-41ba-9c7d-9c48ff1007c2",
          pageCount: 41,
          publishedYear: null,
          publisherName: null,
        },
        book_edition_copy: {
          bookId: "b725fc40-0852-4fc7-bd0e-ab68df0fd2e9",
          callNumber: "E LAW",
          createdAt: "2024-03-11T01:21:06.555Z",
          editionId: "88d88eaf-47ae-40ca-87e6-0d3174054997",
          id: "2ad105b5-3a40-4a09-82b8-e6ac6e5f01a4",
          importRecordId: "a68dabab-279c-4158-8155-25ae0f2eb759",
          libraryId: "f368ad5d-495f-41ba-9c7d-9c48ff1007c2",
        },
        catalog_item: {
          createdAt: "2024-03-11T01:21:06.555Z",
          id: "b725fc40-0852-4fc7-bd0e-ab68df0fd2e9",
          libraryId: "f368ad5d-495f-41ba-9c7d-9c48ff1007c2",
        },
        catalog_item_collection_assignment: null,
        catalog_item_copy: {
          acquisitionDate: null,
          availability: "AVAILABLE",
          barcode: "00000000000006",
          createdAt: "2024-03-11T01:21:06.555Z",
          id: "2ad105b5-3a40-4a09-82b8-e6ac6e5f01a4",
          itemId: "b725fc40-0852-4fc7-bd0e-ab68df0fd2e9",
          libraryId: "f368ad5d-495f-41ba-9c7d-9c48ff1007c2",
          location: null,
          purchasePriceAmount: null,
          purchasePriceCurrency: "USD",
        },
        checkout: null,
        hold: null,
      },
      {
        book: {
          createdAt: "2024-03-11T01:21:06.555Z",
          id: "203c3fb7-094e-4431-b5e4-c7957165fde8",
          libraryId: "f368ad5d-495f-41ba-9c7d-9c48ff1007c2",
          readingGrade: null,
          seriesEntry: null,
          seriesName: null,
          summary:
            "When Jasper Rabbit finds a purple crayon willing to do his schoolwork for him, he is elated--at first.",
          targetAgeMax: 11,
          targetAgeMin: 7,
          title: "Creepy Crayon!",
        },
        book_author: {
          bookId: "203c3fb7-094e-4431-b5e4-c7957165fde8",
          createdAt: "2024-03-11T01:21:06.555Z",
          id: "5c84e452-1d2c-4004-835a-c16dcbe59041",
          index: 1,
          libraryId: "f368ad5d-495f-41ba-9c7d-9c48ff1007c2",
          name: "Brown, Peter",
          relation: "illustrator",
        },
        book_edition: {
          bookId: "203c3fb7-094e-4431-b5e4-c7957165fde8",
          createdAt: "2024-03-11T01:21:06.555Z",
          id: "1ffdd362-d139-47e9-a839-c1884afb9339",
          isbn10: null,
          isbn13: "9781534465886",
          libraryId: "f368ad5d-495f-41ba-9c7d-9c48ff1007c2",
          pageCount: 43,
          publishedYear: null,
          publisherName: null,
        },
        book_edition_copy: {
          bookId: "203c3fb7-094e-4431-b5e4-c7957165fde8",
          callNumber: "FIC REY",
          createdAt: "2024-03-11T01:21:06.555Z",
          editionId: "1ffdd362-d139-47e9-a839-c1884afb9339",
          id: "1aed8fbd-4fd5-4ca7-a05a-c553584b3325",
          importRecordId: "a08ccbec-9fb5-4ccc-a6fd-d2207845b33d",
          libraryId: "f368ad5d-495f-41ba-9c7d-9c48ff1007c2",
        },
        catalog_item: {
          createdAt: "2024-03-11T01:21:06.555Z",
          id: "203c3fb7-094e-4431-b5e4-c7957165fde8",
          libraryId: "f368ad5d-495f-41ba-9c7d-9c48ff1007c2",
        },
        catalog_item_collection_assignment: null,
        catalog_item_copy: {
          acquisitionDate: null,
          availability: "AVAILABLE",
          barcode: "00000000000004",
          createdAt: "2024-03-11T01:21:06.555Z",
          id: "1aed8fbd-4fd5-4ca7-a05a-c553584b3325",
          itemId: "203c3fb7-094e-4431-b5e4-c7957165fde8",
          libraryId: "f368ad5d-495f-41ba-9c7d-9c48ff1007c2",
          location: null,
          purchasePriceAmount: null,
          purchasePriceCurrency: "USD",
        },
        checkout: null,
        hold: null,
      },
      {
        book: {
          createdAt: "2024-03-11T01:21:06.555Z",
          id: "9d091899-8fdd-4b26-a112-23ce32edfe04",
          libraryId: "f368ad5d-495f-41ba-9c7d-9c48ff1007c2",
          readingGrade: null,
          seriesEntry: "8",
          seriesName: "Jasmine Green Rescues",
          summary:
            "While walking her collie, Jasmine hears a whinny from one of the fields on her family's farm. A tiny, injured foal is all alone, so Jasmine decides it's up to her to help him regain his health. With two fluffy rabbits to take care of--and an animal-hating great-aunt visiting--Jasmine and her best friend, Tom, have their work cut out for them. But when their search for the foal's owner leads to a possible horse thief, Jasmine and Tom will need to use their smarts to return the foal to his proper home. From author Helen Peters and illustrator Ellie Snowdon, this latest book in the Jasmine Green Rescues series provides a world of heart and a touch of mystery to horse-loving young readers.",
          targetAgeMax: 9,
          targetAgeMin: 7,
          title: "A Foal Called Storm",
        },
        book_author: {
          bookId: "9d091899-8fdd-4b26-a112-23ce32edfe04",
          createdAt: "2024-03-11T01:21:06.555Z",
          id: "b065132b-43ab-4fde-9ba8-2f9c2eb12aac",
          index: 1,
          libraryId: "f368ad5d-495f-41ba-9c7d-9c48ff1007c2",
          name: "Snowdon, Ellie",
          relation: "illustrator",
        },
        book_edition: {
          bookId: "9d091899-8fdd-4b26-a112-23ce32edfe04",
          createdAt: "2024-03-11T01:21:06.555Z",
          id: "f684a6ee-0bc0-44be-838d-bfc9f5a6ff52",
          isbn10: null,
          isbn13: "9781536222715",
          libraryId: "f368ad5d-495f-41ba-9c7d-9c48ff1007c2",
          pageCount: 137,
          publishedYear: null,
          publisherName: null,
        },
        book_edition_copy: {
          bookId: "9d091899-8fdd-4b26-a112-23ce32edfe04",
          callNumber: "FIC PET",
          createdAt: "2024-03-11T01:21:06.555Z",
          editionId: "f684a6ee-0bc0-44be-838d-bfc9f5a6ff52",
          id: "84839d2e-1f18-4be7-961a-ee9c1df5d715",
          importRecordId: "db8a6402-6422-4af1-a27a-1cfd34da57a5",
          libraryId: "f368ad5d-495f-41ba-9c7d-9c48ff1007c2",
        },
        catalog_item: {
          createdAt: "2024-03-11T01:21:06.555Z",
          id: "9d091899-8fdd-4b26-a112-23ce32edfe04",
          libraryId: "f368ad5d-495f-41ba-9c7d-9c48ff1007c2",
        },
        catalog_item_collection_assignment: null,
        catalog_item_copy: {
          acquisitionDate: null,
          availability: "AVAILABLE",
          barcode: "00000000000008",
          createdAt: "2024-03-11T01:21:06.555Z",
          id: "84839d2e-1f18-4be7-961a-ee9c1df5d715",
          itemId: "9d091899-8fdd-4b26-a112-23ce32edfe04",
          libraryId: "f368ad5d-495f-41ba-9c7d-9c48ff1007c2",
          location: null,
          purchasePriceAmount: null,
          purchasePriceCurrency: "USD",
        },
        checkout: null,
        hold: null,
      },
      {
        book: {
          createdAt: "2024-03-11T01:21:06.555Z",
          id: "b725fc40-0852-4fc7-bd0e-ab68df0fd2e9",
          libraryId: "f368ad5d-495f-41ba-9c7d-9c48ff1007c2",
          readingGrade: null,
          seriesEntry: null,
          seriesName: null,
          summary:
            "The creators of the acclaimed Over the Shop evoke a perfect summer beach day--and themes of creativity, cooperation, flexibility, and persistence--all without a word in this sun-warmed, salt-stained delight of a story. A busload of beachgoers spills out onto the sand for a day of fun and frolic. Three siblings begin work on a castle, patting and shaping the sand as the sun arcs over the sky. Time and again, their progress is halted: a windswept hat topples their creation; a toddler ambles through it; the tide creeps close, and then too close. Meeting each demolition with fresh determination, the builders outdo themselves time and again, until the moment arrives to pile back into the bus for home. An authentic portrait of sibling cooperation--and glorious inspiration for creative people of all ages--A Day for Sandcastles channels the thrill of surrendering expectations on the path to infinite possibility.",
          targetAgeMax: 6,
          targetAgeMin: 5,
          title: "A Day for Sandcastles",
        },
        book_author: {
          bookId: "b725fc40-0852-4fc7-bd0e-ab68df0fd2e9",
          createdAt: "2024-03-11T01:21:06.555Z",
          id: "e006358b-d384-434c-81f9-547a09686e51",
          index: 1,
          libraryId: "f368ad5d-495f-41ba-9c7d-9c48ff1007c2",
          name: "Leng, Qin",
          relation: "illustrator",
        },
        book_edition: {
          bookId: "b725fc40-0852-4fc7-bd0e-ab68df0fd2e9",
          createdAt: "2024-03-11T01:21:06.555Z",
          id: "88d88eaf-47ae-40ca-87e6-0d3174054997",
          isbn10: null,
          isbn13: "9781536208429",
          libraryId: "f368ad5d-495f-41ba-9c7d-9c48ff1007c2",
          pageCount: 41,
          publishedYear: null,
          publisherName: null,
        },
        book_edition_copy: {
          bookId: "b725fc40-0852-4fc7-bd0e-ab68df0fd2e9",
          callNumber: "E LAW",
          createdAt: "2024-03-11T01:21:06.555Z",
          editionId: "88d88eaf-47ae-40ca-87e6-0d3174054997",
          id: "2ad105b5-3a40-4a09-82b8-e6ac6e5f01a4",
          importRecordId: "a68dabab-279c-4158-8155-25ae0f2eb759",
          libraryId: "f368ad5d-495f-41ba-9c7d-9c48ff1007c2",
        },
        catalog_item: {
          createdAt: "2024-03-11T01:21:06.555Z",
          id: "b725fc40-0852-4fc7-bd0e-ab68df0fd2e9",
          libraryId: "f368ad5d-495f-41ba-9c7d-9c48ff1007c2",
        },
        catalog_item_collection_assignment: null,
        catalog_item_copy: {
          acquisitionDate: null,
          availability: "AVAILABLE",
          barcode: "00000000000006",
          createdAt: "2024-03-11T01:21:06.555Z",
          id: "2ad105b5-3a40-4a09-82b8-e6ac6e5f01a4",
          itemId: "b725fc40-0852-4fc7-bd0e-ab68df0fd2e9",
          libraryId: "f368ad5d-495f-41ba-9c7d-9c48ff1007c2",
          location: null,
          purchasePriceAmount: null,
          purchasePriceCurrency: "USD",
        },
        checkout: null,
        hold: null,
      },
      {
        book: {
          createdAt: "2024-03-11T01:21:06.910Z",
          id: "aa12aff9-e213-44e3-9391-eb3d807255bb",
          libraryId: "f368ad5d-495f-41ba-9c7d-9c48ff1007c2",
          readingGrade: null,
          seriesEntry: null,
          seriesName: null,
          summary:
            "A child offers advice on starting a rock band, going on tour, and leaving the audience wanting more.",
          targetAgeMax: 6,
          targetAgeMin: 5,
          title: "How to Be a Rock Star",
        },
        book_author: {
          bookId: "aa12aff9-e213-44e3-9391-eb3d807255bb",
          createdAt: "2024-03-11T01:21:06.910Z",
          id: "7c34a1f4-dab6-432b-8d4a-39d379f7d50d",
          index: 1,
          libraryId: "f368ad5d-495f-41ba-9c7d-9c48ff1007c2",
          name: "Duncan, Daniel",
          relation: "illustrator",
        },
        book_edition: {
          bookId: "aa12aff9-e213-44e3-9391-eb3d807255bb",
          createdAt: "2024-03-11T01:21:06.910Z",
          id: "7da4391e-ad91-490b-b21c-46527c511f49",
          isbn10: null,
          isbn13: "9781984814203",
          libraryId: "f368ad5d-495f-41ba-9c7d-9c48ff1007c2",
          pageCount: 32,
          publishedYear: null,
          publisherName: null,
        },
        book_edition_copy: {
          bookId: "aa12aff9-e213-44e3-9391-eb3d807255bb",
          callNumber: "E TOL",
          createdAt: "2024-03-11T01:21:06.910Z",
          editionId: "7da4391e-ad91-490b-b21c-46527c511f49",
          id: "5af49038-e935-4c48-898a-ede4259ef442",
          importRecordId: "32c3706a-a8ec-411e-8036-3b11e1877358",
          libraryId: "f368ad5d-495f-41ba-9c7d-9c48ff1007c2",
        },
        catalog_item: {
          createdAt: "2024-03-11T01:21:06.910Z",
          id: "aa12aff9-e213-44e3-9391-eb3d807255bb",
          libraryId: "f368ad5d-495f-41ba-9c7d-9c48ff1007c2",
        },
        catalog_item_collection_assignment: null,
        catalog_item_copy: {
          acquisitionDate: null,
          availability: "AVAILABLE",
          barcode: "00000000000011",
          createdAt: "2024-03-11T01:21:06.910Z",
          id: "5af49038-e935-4c48-898a-ede4259ef442",
          itemId: "aa12aff9-e213-44e3-9391-eb3d807255bb",
          libraryId: "f368ad5d-495f-41ba-9c7d-9c48ff1007c2",
          location: null,
          purchasePriceAmount: null,
          purchasePriceCurrency: "USD",
        },
        checkout: null,
        hold: null,
      },
      {
        book: {
          createdAt: "2024-03-11T01:21:06.555Z",
          id: "de340652-2f01-44ff-bf6c-98390a1a9cea",
          libraryId: "f368ad5d-495f-41ba-9c7d-9c48ff1007c2",
          readingGrade: null,
          seriesEntry: null,
          seriesName: null,
          summary:
            "When Pa Peachey comes home in a happy-go-lucky mood--and singing!--the family is concerned. Pa has never not been grumpy after work! But when Ma and siblings Ava and Ollie learn that Pa has gotten a new job--which means moving to an appealing new house--they are all pretty quick to get on board. Even McTavish the dog is excited to make a canine pal in the new park nearby. Only the youngest sibling, Betty, remains out of sorts--nervous about changing schools, making friends, and leaving behind the house where she and McTavish grew up. But McTavish, with his special canine senses--and his vow, as a 'rescue dog,' to save the family whenever need arises--knows how to help Betty regain her confidence and feel at home again. With tenderness and gentle humor, the Peachey family returns in McTavish on the Move, the fourth book in Meg Rosoff's charming series about beloved dog McTavish and his family.",
          targetAgeMax: 9,
          targetAgeMin: 7,
          title: "McTavish on the Move",
        },
        book_author: {
          bookId: "de340652-2f01-44ff-bf6c-98390a1a9cea",
          createdAt: "2024-03-11T01:21:06.555Z",
          id: "7961a04b-888b-42db-ade0-f0909a57c323",
          index: 1,
          libraryId: "f368ad5d-495f-41ba-9c7d-9c48ff1007c2",
          name: "(Illustrator), Shephard, David",
          relation: "illustrator",
        },
        book_edition: {
          bookId: "de340652-2f01-44ff-bf6c-98390a1a9cea",
          createdAt: "2024-03-11T01:21:06.555Z",
          id: "d9ad1756-935e-4c1a-b577-432286b9f1e9",
          isbn10: null,
          isbn13: "9781536213768",
          libraryId: "f368ad5d-495f-41ba-9c7d-9c48ff1007c2",
          pageCount: 82,
          publishedYear: null,
          publisherName: null,
        },
        book_edition_copy: {
          bookId: "de340652-2f01-44ff-bf6c-98390a1a9cea",
          callNumber: "FIC ROS",
          createdAt: "2024-03-11T01:21:06.555Z",
          editionId: "d9ad1756-935e-4c1a-b577-432286b9f1e9",
          id: "077365b9-7ec4-4558-a7ff-d0d67d3d1b06",
          importRecordId: "21017b92-979a-41b4-8ce0-88b89a4c0882",
          libraryId: "f368ad5d-495f-41ba-9c7d-9c48ff1007c2",
        },
        catalog_item: {
          createdAt: "2024-03-11T01:21:06.555Z",
          id: "de340652-2f01-44ff-bf6c-98390a1a9cea",
          libraryId: "f368ad5d-495f-41ba-9c7d-9c48ff1007c2",
        },
        catalog_item_collection_assignment: null,
        catalog_item_copy: {
          acquisitionDate: null,
          availability: "AVAILABLE",
          barcode: "00000000000007",
          createdAt: "2024-03-11T01:21:06.555Z",
          id: "077365b9-7ec4-4558-a7ff-d0d67d3d1b06",
          itemId: "de340652-2f01-44ff-bf6c-98390a1a9cea",
          libraryId: "f368ad5d-495f-41ba-9c7d-9c48ff1007c2",
          location: null,
          purchasePriceAmount: null,
          purchasePriceCurrency: "USD",
        },
        checkout: null,
        hold: null,
      },
      {
        book: {
          createdAt: "2024-03-11T01:21:06.555Z",
          id: "cca9ad95-58cb-4252-847a-fbd2ccf8970d",
          libraryId: "f368ad5d-495f-41ba-9c7d-9c48ff1007c2",
          readingGrade: null,
          seriesEntry: null,
          seriesName: null,
          summary:
            "A hilarious story about sibling rivalry and a child's impulse to run away from home (and come back again!)  When my squawking baby brother arrived, I realized I needed a new family. No one seemed to mind when I packed my bag. I took a box and used my best handwriting to write 'FREE KID', then waited for some new parents to take me home.' Waiting in a box like an abandoned pet and encountering the passersby changes the girl's perspective. At the end of the day, when her parents pretend they need an older sister for their new baby, she is ready to leave her box and go happily back home. In this comical twist on sibling rivalry, a girl decides she needs a new family-so she writes Free Kid on a box and waits in the street for some better parents to choose her. Translated from the Japanese edition, this accessible story is perfect for children starting on independent reading and is illustrated in a graphic comic style that really captures childlike subversive humor. Ideal for fans of Charles Schulz's Peanuts comic strip. A useful book to teach young children about welcoming a new baby sibling to the family, or exploring playful sibling relationships, through funny and lighthearted storytelling.",
          targetAgeMax: 8,
          targetAgeMin: 6,
          title: "Free Kid to Good Home",
        },
        book_author: {
          bookId: "cca9ad95-58cb-4252-847a-fbd2ccf8970d",
          createdAt: "2024-03-11T01:21:06.555Z",
          id: "0e5b6cf7-2c41-4f93-9cf3-80a4bf9ea370",
          index: 1,
          libraryId: "f368ad5d-495f-41ba-9c7d-9c48ff1007c2",
          name: "Hirano, Cathy",
          relation: "translator",
        },
        book_edition: {
          bookId: "cca9ad95-58cb-4252-847a-fbd2ccf8970d",
          createdAt: "2024-03-11T01:21:06.555Z",
          id: "263e3a2f-9193-4387-93ae-d8f21a9b0d2e",
          isbn10: null,
          isbn13: "9781776574421",
          libraryId: "f368ad5d-495f-41ba-9c7d-9c48ff1007c2",
          pageCount: 109,
          publishedYear: null,
          publisherName: null,
        },
        book_edition_copy: {
          bookId: "cca9ad95-58cb-4252-847a-fbd2ccf8970d",
          callNumber: "E ITO",
          createdAt: "2024-03-11T01:21:06.555Z",
          editionId: "263e3a2f-9193-4387-93ae-d8f21a9b0d2e",
          id: "b42c5524-0dc1-494f-bd76-5da239fc4715",
          importRecordId: "b3eb0c58-a499-4711-a738-1486d969bab1",
          libraryId: "f368ad5d-495f-41ba-9c7d-9c48ff1007c2",
        },
        catalog_item: {
          createdAt: "2024-03-11T01:21:06.555Z",
          id: "cca9ad95-58cb-4252-847a-fbd2ccf8970d",
          libraryId: "f368ad5d-495f-41ba-9c7d-9c48ff1007c2",
        },
        catalog_item_collection_assignment: null,
        catalog_item_copy: {
          acquisitionDate: null,
          availability: "AVAILABLE",
          barcode: "00000000000009",
          createdAt: "2024-03-11T01:21:06.555Z",
          id: "b42c5524-0dc1-494f-bd76-5da239fc4715",
          itemId: "cca9ad95-58cb-4252-847a-fbd2ccf8970d",
          libraryId: "f368ad5d-495f-41ba-9c7d-9c48ff1007c2",
          location: null,
          purchasePriceAmount: null,
          purchasePriceCurrency: "USD",
        },
        checkout: null,
        hold: null,
      },
      {
        book: {
          createdAt: "2024-03-11T01:21:06.555Z",
          id: "f0e032f1-c099-47ad-9536-e0e26e7e06e3",
          libraryId: "f368ad5d-495f-41ba-9c7d-9c48ff1007c2",
          readingGrade: null,
          seriesEntry: null,
          seriesName: "ZomBert Chronicles",
          summary:
            "A thrilling finale to an arch mystery-adventure series pits Bert the cat against the infamous YummCo Labs. Bert was a bedraggled stray before nine-year-old Mellie Gore adopted him and has already escaped from YummCo once, vowing to find a way back to free the other captives. Now the Yumms have nabbed Bert again, and he wants revenge. Mellie's plans to rescue her pet are interrupted when the entire town, including her own parents, begin turning into YummCo-product-consuming zombies. And why is Mellie herself suddenly starved for food to fuel her buzzing brain? What exactly is happening at the YummCo Labs? With trademark wit and a taste for the playfully macabre, award-winning creators Kara LaReau and Ryan Andrews close out the ZomBert Chronicles with a funny and suspenseful flourish.",
          targetAgeMax: 10,
          targetAgeMin: 8,
          title: "Revenge of ZomBert",
        },
        book_author: {
          bookId: "f0e032f1-c099-47ad-9536-e0e26e7e06e3",
          createdAt: "2024-03-11T01:21:06.555Z",
          id: "8bd9a688-4342-4300-8d01-dc7039a57ae3",
          index: 1,
          libraryId: "f368ad5d-495f-41ba-9c7d-9c48ff1007c2",
          name: "Andrews, Ryan",
          relation: "illustrator",
        },
        book_edition: {
          bookId: "f0e032f1-c099-47ad-9536-e0e26e7e06e3",
          createdAt: "2024-03-11T01:21:06.555Z",
          id: "797b0a8c-b3fd-4fa7-ad9c-421a5bfcf1d3",
          isbn10: null,
          isbn13: "9781536201086",
          libraryId: "f368ad5d-495f-41ba-9c7d-9c48ff1007c2",
          pageCount: 147,
          publishedYear: null,
          publisherName: null,
        },
        book_edition_copy: {
          bookId: "f0e032f1-c099-47ad-9536-e0e26e7e06e3",
          callNumber: "FIC LAR",
          createdAt: "2024-03-11T01:21:06.555Z",
          editionId: "797b0a8c-b3fd-4fa7-ad9c-421a5bfcf1d3",
          id: "f056ad54-c647-4526-91c3-22f6fe58b0e2",
          importRecordId: "c6cb7694-19cf-4c22-a869-0c400bc02727",
          libraryId: "f368ad5d-495f-41ba-9c7d-9c48ff1007c2",
        },
        catalog_item: {
          createdAt: "2024-03-11T01:21:06.555Z",
          id: "f0e032f1-c099-47ad-9536-e0e26e7e06e3",
          libraryId: "f368ad5d-495f-41ba-9c7d-9c48ff1007c2",
        },
        catalog_item_collection_assignment: null,
        catalog_item_copy: {
          acquisitionDate: null,
          availability: "AVAILABLE",
          barcode: "00000000000005",
          createdAt: "2024-03-11T01:21:06.555Z",
          id: "f056ad54-c647-4526-91c3-22f6fe58b0e2",
          itemId: "f0e032f1-c099-47ad-9536-e0e26e7e06e3",
          libraryId: "f368ad5d-495f-41ba-9c7d-9c48ff1007c2",
          location: null,
          purchasePriceAmount: null,
          purchasePriceCurrency: "USD",
        },
        checkout: null,
        hold: null,
      },
      {
        book: {
          createdAt: "2024-03-11T01:21:06.555Z",
          id: "c1993a4e-fb34-45ab-8bbd-e82e35a6914f",
          libraryId: "f368ad5d-495f-41ba-9c7d-9c48ff1007c2",
          readingGrade: null,
          seriesEntry: null,
          seriesName: null,
          summary:
            "In this rhyming mash-up of many fairy tales, the reader is invited to follow Rosie down the many possible paths which may lead to a sleeping maiden, a hungry wolf, a girl locked in a tower, or a goose that lays golden eggs--but with some luck, and some smart choices, Rosie may save herself and her fellow fairy tale characters.",
          targetAgeMax: 8,
          targetAgeMin: 6,
          title:
            "Endlessly Ever After: Pick Your Path to Countless Fairy Tale Endings! : a Story of Little Red Riding Hood, Jack, Hansel, Gretel, Sleeping Beauty, Snow White, a Wolf, a Witch, a Goose, a Grandmother, Some Pigs, and Endless Variations",
        },
        book_author: {
          bookId: "c1993a4e-fb34-45ab-8bbd-e82e35a6914f",
          createdAt: "2024-03-11T01:21:06.555Z",
          id: "c4c9efc0-51c5-4f91-9330-11d3156214e8",
          index: 1,
          libraryId: "f368ad5d-495f-41ba-9c7d-9c48ff1007c2",
          name: "Santat, Dan",
          relation: "illustrator",
        },
        book_edition: {
          bookId: "c1993a4e-fb34-45ab-8bbd-e82e35a6914f",
          createdAt: "2024-03-11T01:21:06.555Z",
          id: "a3064ab8-f6f9-4443-9929-8c3c287474a6",
          isbn10: null,
          isbn13: "9781452144825",
          libraryId: "f368ad5d-495f-41ba-9c7d-9c48ff1007c2",
          pageCount: 85,
          publishedYear: null,
          publisherName: null,
        },
        book_edition_copy: {
          bookId: "c1993a4e-fb34-45ab-8bbd-e82e35a6914f",
          callNumber: "E SNY",
          createdAt: "2024-03-11T01:21:06.555Z",
          editionId: "a3064ab8-f6f9-4443-9929-8c3c287474a6",
          id: "81f6ae81-a986-4d22-875f-2358afcf553f",
          importRecordId: "62d763e6-f294-4ffe-9459-390640125734",
          libraryId: "f368ad5d-495f-41ba-9c7d-9c48ff1007c2",
        },
        catalog_item: {
          createdAt: "2024-03-11T01:21:06.555Z",
          id: "c1993a4e-fb34-45ab-8bbd-e82e35a6914f",
          libraryId: "f368ad5d-495f-41ba-9c7d-9c48ff1007c2",
        },
        catalog_item_collection_assignment: null,
        catalog_item_copy: {
          acquisitionDate: null,
          availability: "AVAILABLE",
          barcode: "00000000000003",
          createdAt: "2024-03-11T01:21:06.555Z",
          id: "81f6ae81-a986-4d22-875f-2358afcf553f",
          itemId: "c1993a4e-fb34-45ab-8bbd-e82e35a6914f",
          libraryId: "f368ad5d-495f-41ba-9c7d-9c48ff1007c2",
          location: null,
          purchasePriceAmount: null,
          purchasePriceCurrency: "USD",
        },
        checkout: null,
        hold: null,
      },
      {
        book: {
          createdAt: "2024-03-11T01:21:06.555Z",
          id: "de340652-2f01-44ff-bf6c-98390a1a9cea",
          libraryId: "f368ad5d-495f-41ba-9c7d-9c48ff1007c2",
          readingGrade: null,
          seriesEntry: null,
          seriesName: null,
          summary:
            "When Pa Peachey comes home in a happy-go-lucky mood--and singing!--the family is concerned. Pa has never not been grumpy after work! But when Ma and siblings Ava and Ollie learn that Pa has gotten a new job--which means moving to an appealing new house--they are all pretty quick to get on board. Even McTavish the dog is excited to make a canine pal in the new park nearby. Only the youngest sibling, Betty, remains out of sorts--nervous about changing schools, making friends, and leaving behind the house where she and McTavish grew up. But McTavish, with his special canine senses--and his vow, as a 'rescue dog,' to save the family whenever need arises--knows how to help Betty regain her confidence and feel at home again. With tenderness and gentle humor, the Peachey family returns in McTavish on the Move, the fourth book in Meg Rosoff's charming series about beloved dog McTavish and his family.",
          targetAgeMax: 9,
          targetAgeMin: 7,
          title: "McTavish on the Move",
        },
        book_author: {
          bookId: "de340652-2f01-44ff-bf6c-98390a1a9cea",
          createdAt: "2024-03-11T01:21:06.555Z",
          id: "3d35a214-2459-482b-88ab-057b7679e03d",
          index: 2,
          libraryId: "f368ad5d-495f-41ba-9c7d-9c48ff1007c2",
          name: "Easton, Grace",
          relation: null,
        },
        book_edition: {
          bookId: "de340652-2f01-44ff-bf6c-98390a1a9cea",
          createdAt: "2024-03-11T01:21:06.555Z",
          id: "d9ad1756-935e-4c1a-b577-432286b9f1e9",
          isbn10: null,
          isbn13: "9781536213768",
          libraryId: "f368ad5d-495f-41ba-9c7d-9c48ff1007c2",
          pageCount: 82,
          publishedYear: null,
          publisherName: null,
        },
        book_edition_copy: {
          bookId: "de340652-2f01-44ff-bf6c-98390a1a9cea",
          callNumber: "FIC ROS",
          createdAt: "2024-03-11T01:21:06.555Z",
          editionId: "d9ad1756-935e-4c1a-b577-432286b9f1e9",
          id: "077365b9-7ec4-4558-a7ff-d0d67d3d1b06",
          importRecordId: "21017b92-979a-41b4-8ce0-88b89a4c0882",
          libraryId: "f368ad5d-495f-41ba-9c7d-9c48ff1007c2",
        },
        catalog_item: {
          createdAt: "2024-03-11T01:21:06.555Z",
          id: "de340652-2f01-44ff-bf6c-98390a1a9cea",
          libraryId: "f368ad5d-495f-41ba-9c7d-9c48ff1007c2",
        },
        catalog_item_collection_assignment: null,
        catalog_item_copy: {
          acquisitionDate: null,
          availability: "AVAILABLE",
          barcode: "00000000000007",
          createdAt: "2024-03-11T01:21:06.555Z",
          id: "077365b9-7ec4-4558-a7ff-d0d67d3d1b06",
          itemId: "de340652-2f01-44ff-bf6c-98390a1a9cea",
          libraryId: "f368ad5d-495f-41ba-9c7d-9c48ff1007c2",
          location: null,
          purchasePriceAmount: null,
          purchasePriceCurrency: "USD",
        },
        checkout: null,
        hold: null,
      },
    ];

    const res = mapToNested(TEST_DATA, [
      "catalog_item",
      "id",
      {
        book: {
          key: "book",
          mapping: {
            authors: ["book_author", "id"],
            editions: [
              "book_edition",
              "id",
              {
                copies: ["book_edition_copy", "id"],
              },
            ],
          },
        },
        copies: [
          "catalog_item_copy",
          "id",
          {
            checkouts: ["checkout", "id"],
            hold: "hold",
          },
        ],
      },
    ]);

    expect(Array.isArray(res[0]?.book.authors)).toBe(true);
  });
});
